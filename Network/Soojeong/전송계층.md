## 전송계층?

전송 계층은 네트워크 통신에서 프로그램 간 데이터 전달을 담당하는 계층이에요.
우리가 인터넷을 사용하면서 파일을 다운로드하거나, 웹 사이트를 접속하거나, 게임을 하는 등
모든 순간에 전송 계층은 조용히 동작하고 있어요.
전송 계층은 **프로그램과 프로그램 간의 통신을 관리하는 계층**입니다.
웹 브라우저는 웹 서버와 통신하고, 게임 클라이언트는 게임 서버와 통신하는데
이때 서로 데이터를 주고받는 과정 전체를 관리하는 계층이 바로 전송 계층이에요.
전송 계층은 OSI 7계층 중 4계층에 해당하며, 네트워크 계층 위에서 동작해요.

- 네트워크 계층: 목적지 컴퓨터까지 데이터 전달
- 전송 계층: 그 컴퓨터 안의 어떤 프로그램이 받을지 결정

![tcp_ip.png](attachment:374ab409-08a2-4c83-ac60-89f3cd6ef0cb:tcp_ip.png)

---

## 전송계층의 주요 역할

### 포트 번호를 통한 프로세스 식별

하나의 컴퓨터에서는 여러 프로그램이 동시에 네트워크를 사용해요.

이때 데이터를 정확한 프로그램에 전달하기 위해 **포트 번호(Port)**가 사용돼요.

포트 번호는 같은 IP 주소 안에서 프로그램을 구분하는 논리적인 번호예요.

**대표적인 포트 번호 예시**

- HTTP : 80
- HTTPS : 443
- FTP : 21
- SMTP : 25

즉, 통신 상대를 정확히 표현하면 다음과 같아요.

> IP 주소 = 컴퓨터
>
> PORT 번호 = 프로그램

전송 계층은 **IP + PORT** 조합을 이용하여 데이터를 올바른 애플리케이션으로 전달해요.

### 데이터 분할과 재조립 (Segmentation)

응용 계층에서 만들어진 데이터는 크기가 매우 클 수 있어서,

전송 계층은 이를 네트워크에서 전송 가능한 크기로 나누어 전송해요.

**데이터 전송 흐름**

1. 응용 계층에서 데이터 생성
2. 전송 계층에서 작은 단위로 분할
3. 각 조각에 순서 번호 부여
4. 수신 측에서 다시 조립

이 과정을 통해 대용량 데이터도 안정적으로 전달할 수 있어요.

### 오류 제어

데이터는 전송 중 다양한 이유로 손상될 수 있어요.

전송 계층은 다음과 같은 방식으로 오류를 처리해요.

- 데이터 손상 여부 검사 (체크섬)
- 손상된 패킷 폐기
- 필요 시 재전송 요청

따라서 전송 계층은

> “데이터가 깨지지 않게” 보장하는 역할을 해요.

### 흐름 제어 (Flow Control)

송신자와 수신자의 처리 속도는 항상 동일하지 않아요.

만약 송신자가 빠르고 수신자가 느리다면:

- 수신 버퍼 초과
- 데이터 손실 발생

이를 방지하기 위해 전송 계층은 수신자의 처리 속도에 맞춰 전송 속도를 조절해요.

### 혼잡 제어 (Congestion Control)

네트워크에 데이터가 몰리면 다음과 같은 문제가 발생해요.

- 지연 증가
- 패킷 손실 증가
- 전체 네트워크 품질 저하

특히 TCP는 네트워크의 상황을 감지해 전송 속도를 자동으로 조절해요.

이 기능 덕분에:

> 네트워크가 한쪽으로 쏠려도 전체가 마비되지 않도록 보호하고 있어요.

---

## TCP와 UDP

### TCP (Transmission Control Protocol)

TCP는 전송 계층에서 **신뢰성과 순서를 보장하는 통신**을 제공하는 프로토콜이에요..

- 데이터를 보내기 전에 **논리적 연결(connection-oriented)** 을 맺고, 연결이 유지되는 동안에만 데이터를 교환해요.
- 만약 데이터 전송 중 오류가 생기거나, 패킷이 유실되었을 때는 **재전송**을 요청하고, **중복이나 순서 뒤바뀜 없이** 데이터를 받도록 보장해요.
- 더불어 **흐름 제어(flow control)**, **혼잡 제어(congestion control)** 같은 메커니즘을 통해 네트워크와 수신 쪽 상태를 고려하면서 안정적인 전송을 수행해요.

이런 이유로 TCP는 “신뢰성 + 정확한 데이터 전달”이 중요한 서비스에 주로 사용돼요.

### UDP (User Datagram Protocol)

UDP는 TCP와 달리 **연결 설정 없이 바로 데이터를 보내는 방식(connectionless)** 을 사용해요.

- UDP는 최소한의 헤더만 붙여 데이터를 보내므로 오버헤드가 작고 속도가 빨라요.
- 하지만 UDP는 데이터의 **전송 보장, 순서 보장, 재전송** 등을 하지 않아요. 즉, 전송 중 패킷이 사라지거나 순서가 바뀌어도 복구하지 않아요.
- 따라서 빠른 속도와 낮은 지연(latency)이 필요한 실시간 서비스에 적합해요.

UDP는 “속도 + 실시간성”이 중요한 서비스에 많이 사용돼요.

### TCP vs UDP

| 구분             | TCP                                 | UDP                            |
| ---------------- | ----------------------------------- | ------------------------------ |
| 연결 방식        | 연결 지향 (Connection-oriented)     | 비연결형 (Connectionless)      |
| 신뢰성           | 높음 (에러 검사, 재전송, 순서 보장) | 낮음 (보장 없음)               |
| 순서 보장        | O                                   | X                              |
| 재전송           | O                                   | X                              |
| 속도 / 오버헤드  | 느림 / 헤더 길고 제어 많음          | 빠름 / 헤더 작고 단순          |
| 흐름 / 혼잡 제어 | 있음                                | 없음 (앱 레벨에서 처리 필요)   |
| 주 사용 예       | 웹, 파일 전송, 이메일 등            | 실시간 통신, 스트리밍, 게임 등 |

---

### 왜 TCP는 연결 설정이 필요하고, UDP는 안 할까

TCP에서는 통신 전에 서로 “통신 준비 됐는지”를 확인하기 위해 **3-Way Handshake** 과정을 거쳐요.

### 3-Way Handshake 과정

1. 클라이언트 → 서버: **SYN** (연결 요청)
2. 서버 → 클라이언트: **SYN + ACK** (요청 수락 + 동기화)
3. 클라이언트 → 서버: **ACK** (수락 확인)

이 과정을 마쳐야만 TCP 연결이 성립되고, 그 후에야 데이터 송수신이 가능해요.

이 절차 덕분에 양쪽 모두 통신 준비가 되었음을 보장할 수 있고, 연결이 안정적으로 수립된 뒤 데이터를 주고받을 수 있어요.

반면 UDP는 이런 사전 연결 설정 과정을 생략합니다. 바로 데이터를 보낼 수 있기 때문에 속도는 빠르지만, 수신 측이 준비되었는지, 데이터가 무사히 도착할지 등은 보장하지 않아요.

---

### 연결 종료 — TCP 4-Way Handshake

TCP 통신이 끝난 뒤에는 단순히 “끊는다”가 아니라, **정상적으로 종료되었는지** 확인하는 4-Way Handshake 과정을 거쳐요.

### 4단계 종료 과정

1. 한쪽(예: 클라이언트) → 서버: **FIN** (전송 종료 요청)
2. 서버 → 클라이언트: **ACK** (종료 요청 수락)
3. 서버 → 클라이언트: **FIN** (서버도 종료 의사)
4. 클라이언트 → 서버: **ACK** (최종 확인)

이 과정을 통해 양쪽 모두 “더 이상 보낼 데이터가 없다”는 것을 확인하고, 연결을 정리해요.

만약 이 과정을 생략하면, 데이터가 남아 있을 수 있고, 연결이 불완전하게 종료되어 리소스가 낭비될 수 있어요.

---

### 언제 TCP를 쓰고, 언제 UDP를 쓸까?

- **TCP 사용이 적합한 경우**
  – 데이터의 무결성, 순서, 완전 전달이 중요한 경우 (예: 웹 페이지, 파일 다운로드, 이메일, 금융 거래)
  – 패킷 손실이나 순서 변경이 치명적인 서비스
- **UDP 사용이 적합한 경우**
  – 속도와 지연(latency) 최우선 — 약간의 손실을 감수해도 큰 문제가 없는 경우
  – 실시간성 우선 서비스 (예: 온라인 게임, 음성/영상 통화, 실시간 스트리밍)

즉, “정확성 vs 속도”, “신뢰성 vs 실시간성” 중 무엇이 더 중요한지에 따라 선택이 달라집니다.

---

## 전송계층이 없으면

전송 계층이 없다면 인터넷은 지금처럼 안정적으로 동작할 수 없어요.

다음과 같은 문제가 발생할 수 있어요.

- 파일 다운로드 중 데이터 손상
- 영상 스트리밍 잦은 끊김
- 게임 지연 및 튕김 현상
- 메시지 누락 또는 순서 오류
